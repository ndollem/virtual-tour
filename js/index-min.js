"use strict";function DeviceOrientationControlMethod(){this._dynamics={yaw:new Marzipano.Dynamics,pitch:new Marzipano.Dynamics},this._deviceOrientationHandler=this._handleData.bind(this),window.DeviceOrientationEvent&&window.addEventListener("deviceorientation",this._deviceOrientationHandler),this._previous={},this._current={},this._tmp={},this._getPitchCallbacks=[]}function rotateEuler(e,t){var n,i,o,a=Math.cos(e.yaw),s=Math.sin(e.yaw),c=Math.cos(e.pitch),r=Math.sin(e.pitch),d=Math.cos(e.roll),e=Math.sin(e.roll),d=[s*e-a*r*d,-a*c,a*r*e+s*d,c*d,-r,-c*e,s*r*d+a*e,s*c,-s*r*e+a*d];.9999<d[3]?(n=Math.atan2(d[2],d[8]),o=Math.PI/2,i=0):d[3]<-.9999?(n=Math.atan2(d[2],d[8]),o=-Math.PI/2,i=0):(n=Math.atan2(-d[6],d[0]),i=Math.atan2(-d[5],d[4]),o=Math.asin(d[3])),t.yaw=n,t.pitch=o,t.roll=i}Marzipano.dependencies.eventEmitter(DeviceOrientationControlMethod),DeviceOrientationControlMethod.prototype.destroy=function(){this._dynamics=null,window.DeviceOrientationEvent&&window.removeEventListener("deviceorientation",this._deviceOrientationHandler),this._deviceOrientationHandler=null,this._previous=null,this._current=null,this._tmp=null,this._getPitchCallbacks=null},DeviceOrientationControlMethod.prototype.getPitch=function(e){this._getPitchCallbacks.push(e)},DeviceOrientationControlMethod.prototype._handleData=function(e){var t=this._previous,n=this._current,i=this._tmp;i.yaw=Marzipano.util.degToRad(e.alpha),i.pitch=Marzipano.util.degToRad(e.beta),i.roll=Marzipano.util.degToRad(e.gamma),rotateEuler(i,n),this._getPitchCallbacks.forEach(function(e){e(null,n.pitch)}),this._getPitchCallbacks.length=0,null!=t.yaw&&null!=t.pitch&&null!=t.roll&&(this._dynamics.yaw.offset=-(n.yaw-t.yaw),this._dynamics.pitch.offset=n.pitch-t.pitch,this.emit("parameterDynamics","yaw",this._dynamics.yaw),this.emit("parameterDynamics","pitch",this._dynamics.pitch)),t.yaw=n.yaw,t.pitch=n.pitch,t.roll=n.roll},function(){var e,l=window.Marzipano,t=window.bowser,n=window.screenfull,u=window.APP_DATA,i=document.querySelector("#pano"),o=document.querySelector("#titleBar .sceneName"),a=document.querySelector("#sceneList"),s=document.querySelectorAll("#sceneList .scene"),c=document.querySelector("#sceneListToggle"),r=document.querySelector("#autorotateToggle"),d=document.querySelector("#fullscreenToggle");window.matchMedia?(M=function(){e.matches?(document.body.classList.remove("desktop"),document.body.classList.add("mobile")):(document.body.classList.remove("mobile"),document.body.classList.add("desktop"))},e=matchMedia("(max-width: 500px), (max-height: 500px)"),M(),e.addListener(M)):document.body.classList.add("desktop"),document.body.classList.add("no-touch"),window.addEventListener("touchstart",function(){document.body.classList.remove("no-touch"),document.body.classList.add("touch")}),t.msie&&parseFloat(t.version)<11&&document.body.classList.add("tooltip-fallback");var h={controls:{mouseViewMode:u.settings.mouseViewMode}},m=new l.Viewer(i,h),p=new DeviceOrientationControlMethod,v=m.controls();v.registerMethod("deviceOrientation",p);var f=u.scenes.map(function(e){var t=l.ImageUrlSource.fromString("tiles/"+e.id+"/{z}/{f}/{y}/{x}.jpg",{cubeMapPreviewUrl:"tiles/"+e.id+"/preview.jpg"}),n=new l.CubeGeometry(e.levels),i=l.RectilinearView.limit.traditional(e.faceSize,100*Math.PI/180,120*Math.PI/180),o=new l.RectilinearView(e.initialViewParameters,i),a=m.createScene({source:t,geometry:n,view:o,pinFirstLevel:!0});e.embedHotspot.forEach(function(e){var t=a.hotspotContainer(),n=document.getElementById(e.id);t.createHotspot(n,{yaw:e.yaw,pitch:e.pitch},{perspective:{radius:e.radius,extraTransforms:e.extraTransforms}}),n.innerHTML=e.url}),e.linkHotspots.forEach(function(e){var t=function(e){var t=document.createElement("div");t.classList.add("hotspot"),t.classList.add("link-hotspot");var n=document.createElement("img");n.src="img/link.png",n.classList.add("link-hotspot-icon");for(var i=["-ms-transform","-webkit-transform","transform"],o=0;o<i.length;o++){var a=i[o];n.style[a]="rotate("+e.rotation+"rad)"}t.addEventListener("click",function(){E(function(e){for(var t=0;t<f.length;t++)if(f[t].data.id===e)return f[t];return null}(e.target))}),P(t);var s=document.createElement("div");return s.classList.add("hotspot-tooltip"),s.classList.add("link-hotspot-tooltip"),s.innerHTML=function(e){for(var t=0;t<u.scenes.length;t++)if(u.scenes[t].id===e)return u.scenes[t];return null}(e.target).name,t.appendChild(n),t.appendChild(s),t}(e);a.hotspotContainer().createHotspot(t,{yaw:e.yaw,pitch:e.pitch})}),e.infoHotspots.forEach(function(e){var t=null==e.type?function(e){var t=document.createElement("div");t.classList.add("hotspot"),t.classList.add("info-hotspot");var n=document.createElement("div");n.classList.add("info-hotspot-header");var i=document.createElement("div");i.classList.add("info-hotspot-icon-wrapper");var o=document.createElement("img");o.src="img/info.png",o.classList.add("info-hotspot-icon"),i.appendChild(o);var a=document.createElement("div");a.classList.add("info-hotspot-title-wrapper");var s=document.createElement("div");s.classList.add("info-hotspot-title"),s.innerHTML=e.title,a.appendChild(s);o=document.createElement("div");o.classList.add("info-hotspot-close-wrapper");s=document.createElement("img");s.src="img/close.png",s.classList.add("info-hotspot-close-icon"),o.appendChild(s),n.appendChild(i),n.appendChild(a),n.appendChild(o);o=document.createElement("div");o.classList.add("info-hotspot-text"),o.innerHTML=e.text,t.appendChild(n),t.appendChild(o);var c=document.createElement("div");c.innerHTML=t.innerHTML,c.classList.add("info-hotspot-modal"),document.body.appendChild(c);o=function(){t.classList.toggle("visible"),c.classList.toggle("visible")};return t.querySelector(".info-hotspot-header").addEventListener("click",o),c.querySelector(".info-hotspot-close-wrapper").addEventListener("click",o),P(t),t}(e):document.getElementById(e.elementID);a.hotspotContainer().createHotspot(t,{yaw:e.yaw,pitch:e.pitch}),"info"==e.type&&(document.querySelector("#info .icon_wrapper").addEventListener("click",function(){document.querySelector("#info").classList.toggle("expanded"),document.querySelector("#inner_icon").classList.toggle("closeIcon")}),document.querySelector("#info .close").addEventListener("click",function(){document.querySelector("#info").classList.remove("expanded"),document.querySelector("#inner_icon").classList.remove("closeIcon")}),document.querySelector('#info input[type="text"]').addEventListener("keydown",function(e){e.stopPropagation()}))});var s=!1,c=document.getElementById("toggleDeviceOrientation");function r(){p.getPitch(function(e,t){e||o.setPitch(t)}),v.enableMethod("deviceOrientation"),s=!0,c.className="enabled"}function d(){window.DeviceOrientationEvent&&("function"==typeof window.DeviceOrientationEvent.requestPermission?window.DeviceOrientationEvent.requestPermission().then(e=>{"granted"===e&&r()}).catch(e=>{console.error(e)}):r())}return c.addEventListener("click",function(){s?(v.disableMethod("deviceOrientation"),s=!1,c.className=""):d()}),{data:e,scene:a,view:o}}),w=l.autorotate({yawSpeed:.03,targetPitch:0,targetFov:Math.PI/2});u.settings.autorotateEnabled&&r.classList.add("enabled"),r.addEventListener("click",function(){r.classList.contains("enabled")?(r.classList.remove("enabled"),C()):(r.classList.add("enabled"),b())}),n.enabled&&u.settings.fullscreenButton?(document.body.classList.add("fullscreen-enabled"),d.addEventListener("click",function(){n.toggle()}),n.on("change",function(){n.isFullscreen?d.classList.add("enabled"):d.classList.remove("enabled")})):document.body.classList.add("fullscreen-disabled"),c.addEventListener("click",function(){a.classList.toggle("enabled"),c.classList.toggle("enabled")}),document.body.classList.contains("mobile")||(a.classList.add("enabled"),c.classList.add("enabled")),f.forEach(function(e){document.querySelector('#sceneList .scene[data-id="'+e.data.id+'"]').addEventListener("click",function(){E(e),document.body.classList.contains("mobile")&&(a.classList.remove("enabled"),c.classList.remove("enabled"))})});var y=document.querySelector("#viewUp"),g=document.querySelector("#viewDown"),L=document.querySelector("#viewLeft"),M=document.querySelector("#viewRight"),t=document.querySelector("#viewIn"),i=document.querySelector("#viewOut"),h=.7;function E(e){var t;C(),e.view.setParameters(e.data.initialViewParameters),e.scene.switchTo(),b(),t=e,o.innerHTML=t.data.name.replace("&","&amp;").replace("<","&lt;").replace(">","&gt;"),function(e){for(var t=0;t<s.length;t++){var n=s[t];n.getAttribute("data-id")===e.data.id?n.classList.add("current"):n.classList.remove("current")}}(e)}function b(){r.classList.contains("enabled")&&(m.startMovement(w),m.setIdleMovement(3e3,w))}function C(){m.stopMovement(),m.setIdleMovement(1/0)}function P(e,t){for(var t=["touchstart","touchmove","touchend","touchcancel","wheel","mousewheel"],n=0;n<t.length;n++)e.addEventListener(t[n],function(e){e.stopPropagation()})}(v=m.controls()).registerMethod("upElement",new l.ElementPressControlMethod(y,"y",-h,3),!0),v.registerMethod("downElement",new l.ElementPressControlMethod(g,"y",h,3),!0),v.registerMethod("leftElement",new l.ElementPressControlMethod(L,"x",-h,3),!0),v.registerMethod("rightElement",new l.ElementPressControlMethod(M,"x",h,3),!0),v.registerMethod("inElement",new l.ElementPressControlMethod(t,"zoom",-h,3),!0),v.registerMethod("outElement",new l.ElementPressControlMethod(i,"zoom",h,3),!0),E(f[0])}();